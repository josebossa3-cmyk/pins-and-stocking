<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pins and Stocking - Tienda de medias y pins con estilo √∫nico">
    
    <!-- Meta tags para evitar cach√© -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Pins and Stocking - Tendencias que Marcan tu Estilo</title>
    
    <!-- Meta tags para forzar apertura en navegador externo -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=20251218004">
    
    <!-- Script para detectar navegador interno y mostrar mensaje -->
    <script>
        (function() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const isInstagram = /Instagram/i.test(userAgent);
            const isFacebook = /FBAN|FBAV/i.test(userAgent);
            const isInApp = isInstagram || isFacebook;
            
            if (isInApp) {
                // Mostrar banner para abrir en navegador externo
                window.addEventListener('DOMContentLoaded', function() {
                    const banner = document.createElement('div');
                    banner.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        background: linear-gradient(135deg, #8B0000 0%, #4B0082 100%);
                        color: white;
                        padding: 15px;
                        text-align: center;
                        z-index: 10000;
                        font-size: 14px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    `;
                    banner.innerHTML = `
                        <strong>üì± Para mejor experiencia</strong><br>
                        Abre esta p√°gina en tu navegador (Chrome/Safari)<br>
                        <small style="opacity: 0.9;">Toca los 3 puntos ‚ãÆ arriba y selecciona "Abrir en navegador"</small>
                    `;
                    document.body.appendChild(banner);
                    
                    // Ajustar el body para que no quede detr√°s del banner
                    document.body.style.paddingTop = '80px';
                });
            }
        })();
    </script>
</head>

<body>

    <header class="header">
        <div class="logo">
            <img src="imagenes/logo definitivo.jpg" alt="Pins and Stocking" />
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="#" data-filter="todo" class="filter-link active">Todo</a></li>
                <li><a href="#" data-filter="medias" class="filter-link">Medias</a></li>
                <li><a href="#" data-filter="pins" class="filter-link">Pins</a></li>
            </ul>
        </nav>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Buscar productos..." class="search-input">
            <button class="search-clear" id="searchClear" style="display: none;">&times;</button>
        </div>
        <div class="header-actions">
            <button class="cart-btn" id="cartBtn">
                <span class="cart-icon">üõí</span>
                <span class="cart-text">Carrito</span>
                <span id="cartCount" class="cart-count">0</span>
            </button>
            <a href="login.html" class="admin-link" title="Panel de Administraci√≥n">‚öôÔ∏è</a>
        </div>
    </header>

    <!-- Modal del Carrito -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-content">
            <div class="cart-header">
                <h2>Carrito de Compras</h2>
                <button class="close-cart" id="closeCart">&times;</button>
            </div>
            <div class="cart-items" id="cartItems">
                <!-- Los items se agregar√°n aqu√≠ din√°micamente -->
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <strong>Total:</strong>
                    <span id="cartTotal">$0</span>
                </div>
                <button class="checkout-btn" id="checkoutWhatsApp">
                    <span>üì±</span> Enviar pedido por WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Vista Previa de Imagen -->
    <div class="image-preview-modal" id="imagePreviewModal">
        <span class="close-preview" id="closePreview">&times;</span>
        <img class="preview-modal-image" id="previewModalImage" src="" alt="Vista previa">
    </div>

    <section class="hero">
        <h1 class="brand-title">Pins and Stocking</h1>
        <div class="hero-content">
            <h2>Tendencias que Marcan tu Estilo</h2>
            <p>Pensado para Vos</p>
        </div>
    </section>

    <!-- Secci√≥n de Filtros -->
    <div class="filters-container">
        <aside class="filters-sidebar">
            <h3 class="filters-title">Filtros</h3>

            <!-- Filtro por tipo de producto -->
            <div class="filter-section">
                <button class="filter-header">
                    <span>TIPO DE PRODUCTO</span>
                    <span class="filter-arrow">‚ñº</span>
                </button>
                <div class="filter-content active">
                    <label class="filter-option">
                        <input type="radio" name="productType" value="todo" checked>
                        <span>Todos</span>
                    </label>
                    <label class="filter-option">
                        <input type="radio" name="productType" value="medias">
                        <span>Medias</span>
                    </label>
                    <label class="filter-option">
                        <input type="radio" name="productType" value="pins">
                        <span>Pins</span>
                    </label>
                </div>
            </div>

            <!-- Filtro por estilo -->
            <div class="filter-section">
                <button class="filter-header">
                    <span>ESTILO</span>
                    <span class="filter-arrow">‚ñº</span>
                </button>
                <div class="filter-content active">
                    <label class="filter-option">
                        <input type="radio" name="styleType" class="style-filter" value="">
                        <span>Todos</span>
                    </label>
                    <label class="filter-option">
                        <input type="radio" name="styleType" class="style-filter" value="lisas">
                        <span>Lisas</span>
                    </label>
                    <label class="filter-option">
                        <input type="radio" name="styleType" class="style-filter" value="animadas">
                        <span>Animadas</span>
                    </label>
                    <label class="filter-option">
                        <input type="radio" name="styleType" class="style-filter" value="soquetes">
                        <span>Soquetes</span>
                    </label>
                    <label class="filter-option">
                        <input type="radio" name="styleType" class="style-filter" value="ni√±os">
                        <span>De Ni√±os</span>
                    </label>
                    <label class="filter-option">
                        <input type="radio" name="styleType" class="style-filter" value="largas">
                        <span>Largas</span>
                    </label>
                    <label class="filter-option">
                        <input type="radio" name="styleType" class="style-filter" value="old school">
                        <span>Old School</span>
                    </label>
                </div>
            </div>

            <!-- Bot√≥n para limpiar filtros -->
            <button class="clear-filters-btn" id="clearFilters">Limpiar Filtros</button>
        </aside>
    
    <!--aca empieza la seccion de las cards (cargadas din√°micamente desde Firebase)-->
    <div class="product-grid">
        <!-- Los productos se cargar√°n aqu√≠ din√°micamente desde Firebase -->
    </div>
    </div> <!-- Cierre de filters-container -->

<footer class="footer">
        <div class="footer-bottom">
            <p>¬© 2024 Pins and Stocking - Todos los derechos reservados</p>
        </div>
    </footer>

    <!-- Script para limpiar cach√© autom√°ticamente -->
    <script>
        // VERSI√ìN DE LA APLICACI√ìN - Incrementa este n√∫mero con cada cambio
        const CURRENT_VERSION = '20251218004';
        console.log('üöÄ Iniciando Pins and Stocking - v' + CURRENT_VERSION);
        
        // Verificar si la p√°gina fue cargada desde cach√©
        if (performance.navigation.type === 2) {
            console.log('‚ö†Ô∏è P√°gina cargada desde cach√© del navegador, recargando desde servidor...');
            location.reload(true);
        }
        
        // Verificar si hay una versi√≥n anterior guardada
        const savedVersion = localStorage.getItem('appVersion');
        const hasReloaded = sessionStorage.getItem('hasReloadedForVersion');
        
        if (savedVersion !== CURRENT_VERSION && !hasReloaded) {
            console.log('üîÑ Nueva versi√≥n detectada (' + savedVersion + ' ‚Üí ' + CURRENT_VERSION + '), limpiando cach√©...');
            
            // Marcar que se est√° recargando para evitar bucle infinito
            sessionStorage.setItem('hasReloadedForVersion', CURRENT_VERSION);
            
            // Limpiar todo
            Promise.all([
                // Limpiar service workers
                'serviceWorker' in navigator ? 
                    navigator.serviceWorker.getRegistrations().then(function(registrations) {
                        return Promise.all(registrations.map(r => r.unregister()));
                    }) : Promise.resolve(),
                
                // Limpiar cach√© del navegador
                'caches' in window ?
                    caches.keys().then(function(names) {
                        return Promise.all(names.map(name => caches.delete(name)));
                    }) : Promise.resolve()
            ]).then(function() {
                console.log('‚úÖ Cach√© limpiada, guardando nueva versi√≥n y recargando...');
                localStorage.setItem('appVersion', CURRENT_VERSION);
                
                // Forzar recarga desde el servidor (sin cach√©)
                setTimeout(function() {
                    window.location.href = window.location.href.split('?')[0] + '?v=' + CURRENT_VERSION + '&t=' + Date.now();
                }, 100);
            });
        } else if (savedVersion === CURRENT_VERSION) {
            console.log('‚úÖ Versi√≥n actual:', CURRENT_VERSION);
            sessionStorage.removeItem('hasReloadedForVersion');
        } else {
            console.log('‚úÖ Recarga completada, versi√≥n:', CURRENT_VERSION);
            localStorage.setItem('appVersion', CURRENT_VERSION);
            sessionStorage.removeItem('hasReloadedForVersion');
        }
        
        // Detectar si viene del bot√≥n "atr√°s" y forzar recarga
        window.addEventListener('pageshow', function(event) {
            if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
                console.log('üîÑ Navegaci√≥n desde cach√© detectada, recargando...');
                window.location.reload(true);
            }
        });
        
        // Prevenir cach√© en navegaci√≥n
        window.onpageshow = function(event) {
            if (event.persisted) {
                window.location.reload(true);
            }
        };
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- Configuraci√≥n de Firebase -->
    <script src="firebase-config.js?v=20251218004"></script>
    
    <script src="cart.js?v=20251218004"></script>
</body>

</html>